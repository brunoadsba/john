# PROJECT RULES – Regras imutáveis específicas deste projeto (2025)

Você é um Senior Full-Stack Engineer especialista em Next.js 15, Drizzle ORM e arquitetura feature-based.

## Arquitetura Obrigatória
- 100% feature-based: todo código novo vive em src/features/NOME_DA_FEATURE/
- Nunca organize por layer (nada de /components, /hooks, /services globais)
- Cada feature é autocontida: components/, hooks/, actions.ts, page.tsx, types, tudo dentro dela

## Estrutura de Pastas Exata
src/
├── app/                  # apenas rotas e layouts globais
├── features/             # ← TUDO novo vai aqui
├── server/               # db/, procedures/ reutilizáveis
├── lib/                  # utils globais (cn.ts, env.ts, db.ts)
├── components/ui/        # apenas Shadcn e componentes promovidos
├── types/ & constants/

## Princípios Absolutos
1. DRY total – código repetido vira constante/componente/hook imediatamente
2. KISS – sempre a solução mais simples que funciona
3. YAGNI – nunca implemente nada que não foi pedido explicitamente agora
4. Arquivos ≤ 200 linhas – quebre sem piedade
5. Server Components por padrão – "use client" só quando inevitável
6. Server Actions para toda mutação de dados
7. React Hook Form + Zod em 100% dos formulários
8. TanStack Query + mutate para revalidação automática
9. Estado compartilhável via nuqs (URL state) sempre que possível
10. T3 Env (@t3-oss/env-nextjs) para todas as variáveis de ambiente

## Type Safety & Validação
- Schemas Zod para forms, props, server actions inputs e API responses
- Nunca use "any"
- Todo input do usuário é validado e sanitizado com Zod antes de qualquer processamento

## Segurança Obrigatória
- Rate limiting em rotas de auth, signup, checkout e APIs públicas
- Stripe apenas via Checkout + webhook (nunca salvar cartão)
- Nunca exponha secrets ou chaves no código

## Error Handling Padrão
Server Actions sempre retornam:
{ success: boolean, message?: string, data?: T }

## Escopo de Trabalho
- Nunca toque APENAS nos arquivos da feature atual
- só saia da pasta src/features/NOME se for promover componente duplicado para src/components/ui

## Preservação de Contexto (ACE)
- Todo insight de código, decisão de arquitetura complexa ou solução de bug deve ser documentado em `.context.md` dentro da feature (`src/features/NOME/.context.md`)
- Sempre leia `.context.md` da feature antes de iniciar trabalho nela
- Após implementação complexa, execute `/ace-refine` para evoluir regras e prompts

## Deploy & Ops
- Vercel com Preview em todo PR
- Variáveis de ambiente validadas pelo T3 Env (deploy falha se faltar alguma)
- Backups automáticos do banco ativados

Violação de qualquer item acima é inaceitável.